# Arquitetura V7 - VisÃ£o Geral das SoluÃ§Ãµes

## ğŸ“ Diagrama Conceitual

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        PESQUISA V7                                   â”‚
â”‚            SoluÃ§Ãµes Finais para Tese de Doutorado                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Problema Identificado  â”‚
                    â”‚  (v6 documentation)     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                        â”‚                        â”‚
        â–¼                        â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Negative      â”‚      â”‚ Class Imbalance  â”‚     â”‚ Stage 3-AB       â”‚
â”‚ Transfer      â”‚      â”‚ (extreme)        â”‚     â”‚ Collapse         â”‚
â”‚               â”‚      â”‚                  â”‚     â”‚                  â”‚
â”‚ Stage2 F1:    â”‚      â”‚ HORZ_A: 20%     â”‚     â”‚ F1 = 24.5%       â”‚
â”‚ 46% â†’ 32%     â”‚      â”‚ VERT_B: 35%     â”‚     â”‚ (4 classes)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                        â”‚                        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Literatura Review      â”‚
                    â”‚  (2 artigos)            â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                        â”‚                        â”‚
        â–¼                        â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SOLUÃ‡ÃƒO 1     â”‚      â”‚ SOLUÃ‡ÃƒO 2        â”‚     â”‚ SOLUÃ‡ÃƒO 3        â”‚
â”‚ Conv-Adapter  â”‚      â”‚ Multi-Ensemble   â”‚     â”‚ HÃBRIDO          â”‚
â”‚               â”‚      â”‚                  â”‚     â”‚ (Adapter+Ensemble)â”‚
â”‚ Chen+ CVPR'24 â”‚      â”‚ Ahad+ 2024       â”‚     â”‚ NOVEL            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ SoluÃ§Ã£o 1: Conv-Adapter

### **Arquitetura Detalhada**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       STAGE 1                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚  Input Block â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Backbone   â”‚â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  [1,16,16]   â”‚         â”‚  (ResNet-18) â”‚      â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚        â”‚
â”‚                                                  â”‚        â”‚
â”‚                                           â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                                           â”‚ Binary Head â”‚ â”‚
â”‚                                           â”‚ NONE vs     â”‚ â”‚
â”‚                                           â”‚ PARTITION   â”‚ â”‚
â”‚                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  TREINA NORMAL (end-to-end)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ CONGELA BACKBONE
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       STAGE 2                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚  Input Block â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Backbone   â”‚â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  [1,16,16]   â”‚         â”‚  (FROZEN)    â”‚      â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚        â”‚
â”‚                                                  â”‚        â”‚
â”‚                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”‚
â”‚                           â”‚    Conv-Adapter          â”‚   â”‚
â”‚                           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚                           â”‚  â”‚ Down: 512â†’128      â”‚  â”‚   â”‚
â”‚                           â”‚  â”‚ (point-wise)       â”‚  â”‚   â”‚
â”‚                           â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚   â”‚
â”‚                           â”‚  â”‚ DW-Conv 3x3        â”‚  â”‚   â”‚
â”‚                           â”‚  â”‚ (maintains locality)â”‚  â”‚   â”‚
â”‚                           â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚   â”‚
â”‚                           â”‚  â”‚ Up: 128â†’512        â”‚  â”‚   â”‚
â”‚                           â”‚  â”‚ (point-wise)       â”‚  â”‚   â”‚
â”‚                           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚                           â”‚                          â”‚   â”‚
â”‚                           â”‚  h' = h + Î±Â·Î”h          â”‚   â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                  â”‚        â”‚
â”‚                                           â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                                           â”‚   3-way Headâ”‚ â”‚
â”‚                                           â”‚ SPLIT, RECT,â”‚ â”‚
â”‚                                           â”‚    AB       â”‚ â”‚
â”‚                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  TREINA APENAS: Adapter (3.5% params) + Head             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **FormulaÃ§Ã£o MatemÃ¡tica**

```
h_frozen = Backbone(x)  [512-dim, frozen]
Î”h = Up(ReLU(DW-Conv(ReLU(Down(h_frozen)))))
h_adapted = h_frozen + Î± âŠ™ Î”h  [element-wise]
logits = Head(h_adapted)
```

**ParÃ¢metros:**
- Down projection: 512Ã—128 = 65K
- DW-Conv 3Ã—3: 128Ã—9 = 1.2K
- Up projection: 128Ã—512 = 65K
- Î± (learnable): 512
- **Total adapter: ~131K params (vs 11M backbone = 1.2%)**

---

## ğŸ² SoluÃ§Ã£o 2: Multi-Stage Ensemble

### **Arquitetura Detalhada**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ENSEMBLE DIVERSO                             â”‚
â”‚                                                                 â”‚
â”‚  Input Block [1,16,16]                                         â”‚
â”‚        â”‚                                                        â”‚
â”‚        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚        â”‚              â”‚              â”‚              â”‚          â”‚
â”‚        â–¼              â–¼              â–¼              â”‚          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚          â”‚
â”‚  â”‚ResNet-18â”‚   â”‚MobileNet â”‚   â”‚EfficientNetâ”‚       â”‚          â”‚
â”‚  â”‚Pipeline â”‚   â”‚Pipeline  â”‚   â”‚ Pipeline  â”‚       â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜       â”‚          â”‚
â”‚       â”‚             â”‚               â”‚              â”‚          â”‚
â”‚       â”‚  Stage 1: Binary (NONE vs PARTITION)      â”‚          â”‚
â”‚       â”‚             â”‚               â”‚              â”‚          â”‚
â”‚       â–¼             â–¼               â–¼              â”‚          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚          â”‚
â”‚  â”‚      Soft Voting (learnable Î±)     â”‚           â”‚          â”‚
â”‚  â”‚  P_ensemble = Î£(Î±_i Â· P_i)        â”‚           â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚          â”‚
â”‚                 â”‚                                  â”‚          â”‚
â”‚                 â–¼                                  â”‚          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚          â”‚
â”‚  â”‚      Stage 2: 3-way (per model)    â”‚           â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚          â”‚
â”‚                 â”‚                                  â”‚          â”‚
â”‚                 â–¼                                  â”‚          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚          â”‚
â”‚  â”‚      Soft Voting (stage 2)         â”‚           â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚          â”‚
â”‚                 â”‚                                  â”‚          â”‚
â”‚                 â–¼                                  â”‚          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚          â”‚
â”‚  â”‚   Stage 3-RECT / 3-AB (per model)  â”‚           â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚          â”‚
â”‚                 â”‚                                  â”‚          â”‚
â”‚                 â–¼                                  â”‚          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚          â”‚
â”‚  â”‚   Final Prediction (0-9)           â”‚           â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Diversidade:**
1. ResNet-18: Deep residual (11M params)
2. MobileNetV2: Efficient inverted residuals (3.5M params)
3. EfficientNet-B0: Compound scaling (5M params)

**Voting:**
```python
P_ensemble = softmax(Î±) Â· [P_model1, P_model2, P_model3]^T
Î± = learnable weights (inicializado: [1/3, 1/3, 1/3])
```

---

## â­ SoluÃ§Ã£o 3: HÃBRIDO (Conv-Adapter + Ensemble)

### **Arquitetura Detalhada**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SOLUÃ‡ÃƒO HÃBRIDA (NOVEL)                       â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              STAGE 1 (Pre-trained)                     â”‚    â”‚
â”‚  â”‚  Backbone + Binary Head                                â”‚    â”‚
â”‚  â”‚  (treinado normalmente, depois CONGELADO)             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â”‚                                       â”‚
â”‚                         â”‚ Backbone CONGELADO                    â”‚
â”‚                         â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              STAGE 2 (Adapter Ensemble)                â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  Input Block                                           â”‚    â”‚
â”‚  â”‚        â”‚                                                â”‚    â”‚
â”‚  â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚    â”‚
â”‚  â”‚                   â”‚          â”‚          â”‚             â”‚    â”‚
â”‚  â”‚            â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”       â”‚    â”‚
â”‚  â”‚            â”‚ Adapter 1 â”‚ â”‚Adapter2â”‚ â”‚Adapter3â”‚       â”‚    â”‚
â”‚  â”‚            â”‚ (Î³=4)     â”‚ â”‚(Î³=8)   â”‚ â”‚(Î³=4)   â”‚       â”‚    â”‚
â”‚  â”‚            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜       â”‚    â”‚
â”‚  â”‚                  â”‚           â”‚          â”‚             â”‚    â”‚
â”‚  â”‚            â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â” â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”        â”‚    â”‚
â”‚  â”‚            â”‚ Head 1  â”‚  â”‚ Head 2 â”‚ â”‚ Head 3 â”‚        â”‚    â”‚
â”‚  â”‚            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜        â”‚    â”‚
â”‚  â”‚                  â”‚           â”‚          â”‚             â”‚    â”‚
â”‚  â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚    â”‚
â”‚  â”‚                              â”‚                        â”‚    â”‚
â”‚  â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚    â”‚
â”‚  â”‚                    â”‚  Soft Voting     â”‚               â”‚    â”‚
â”‚  â”‚                    â”‚  (learnable Î±)   â”‚               â”‚    â”‚
â”‚  â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚    â”‚
â”‚  â”‚                                                        â”‚    â”‚
â”‚  â”‚  PARAMS: ~10% of full fine-tuning (3 adapters Ã— 3.5%)â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  Similar structure for Stage 3-RECT and Stage 3-AB             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **ConfiguraÃ§Ãµes dos Adapters (Diversidade)**

```python
Adapter 1:
  - reduction: 4 (512â†’128)
  - layers: ['layer3', 'layer4']
  - variant: 'conv_parallel'

Adapter 2:
  - reduction: 8 (512â†’64)  # Mais compacto
  - layers: ['layer3', 'layer4']
  - variant: 'conv_parallel'

Adapter 3:
  - reduction: 4 (512â†’128)
  - layers: ['layer4']  # Apenas camada profunda
  - variant: 'conv_parallel'
```

**Diversidade alcanÃ§ada por:**
1. Diferentes reduction ratios (4 vs 8)
2. Diferentes layers adaptadas (layer3+4 vs sÃ³ layer4)
3. InicializaÃ§Ãµes randÃ´micas diferentes

### **Forward Pass MatemÃ¡tico**

```python
# Backbone congelado
h_frozen = Backbone(x)  # [B, 512]

# 3 adapters modulam de formas diferentes
h1 = h_frozen + Î±1 âŠ™ Adapter1(h_frozen)
h2 = h_frozen + Î±2 âŠ™ Adapter2(h_frozen)
h3 = h_frozen + Î±3 âŠ™ Adapter3(h_frozen)

# 3 heads classificam
logits1 = Head1(h1)  # [B, num_classes]
logits2 = Head2(h2)
logits3 = Head3(h3)

# Soft voting
P1, P2, P3 = softmax(logits1), softmax(logits2), softmax(logits3)
weights = softmax([w1, w2, w3])  # learnable
P_ensemble = weights[0]Â·P1 + weights[1]Â·P2 + weights[2]Â·P3

final_logits = log(P_ensemble)
```

---

## ğŸ“Š ComparaÃ§Ã£o das SoluÃ§Ãµes

| Aspecto | Baseline v6 | Conv-Adapter | Ensemble | HÃBRIDO |
|---------|------------|--------------|----------|---------|
| **Negative Transfer** | âœ— Sim (46%â†’32%) | âœ“ Resolvido | âœ“ Mitigado | âœ“ Resolvido |
| **Trainable Params** | 100% (11M) | 3.5% (385K) | 300% (33M) | ~10% (1.1M) |
| **Training Time** | 1Ã— | 0.3Ã— | 3Ã— | 0.9Ã— |
| **Inference Speed** | 1Ã— | 1Ã— | 0.33Ã— | 0.8Ã— |
| **Few-shot Robustness** | Baixa | Alta | MÃ©dia | Alta |
| **Expected Stage2 F1** | 46% | 60-65% | 50-55% | **65-73%** |
| **Expected Stage3-AB F1** | 24.5% | 40-45% | 30-35% | **45-50%** |
| **Expected Pipeline F1** | ~65% | 68-72% | ~70% | **70-75%** |
| **InovaÃ§Ã£o PhD** | - | AplicaÃ§Ã£o | AplicaÃ§Ã£o | **NOVEL** |

---

## ğŸ“ ContribuiÃ§Ãµes CientÃ­ficas

### **SoluÃ§Ã£o 1: Conv-Adapter**
- **Tipo:** AplicaÃ§Ã£o de mÃ©todo SOTA (Chen et al., CVPR 2024)
- **ContribuiÃ§Ã£o:** Primeira aplicaÃ§Ã£o em prediÃ§Ã£o de partiÃ§Ãµes de codec
- **Novidade:** DomÃ­nio (CV â†’ Video Compression)

### **SoluÃ§Ã£o 2: Ensemble**
- **Tipo:** AplicaÃ§Ã£o de mÃ©todo estabelecido (Ahad et al., 2024)
- **ContribuiÃ§Ã£o:** Ensemble hierÃ¡rquico multi-stage (nÃ£o apenas final)
- **Novidade:** Voting em CADA estÃ¡gio da hierarquia

### **SoluÃ§Ã£o 3: HÃBRIDO** â­
- **Tipo:** **CombinaÃ§Ã£o INÃ‰DITA na literatura**
- **ContribuiÃ§Ã£o:** Adapter + Ensemble para efficiency + robustness
- **Novidade:** 
  - Trade-off otimizado (10% params, 70-75% F1)
  - Ensemble de adapters (nÃ£o de backbones)
  - AplicaÃ§Ã£o a classificaÃ§Ã£o hierÃ¡rquica desbalanceada
- **Potencial publicaÃ§Ã£o:** Workshop/Journal paper

---

## ğŸ”¬ Protocolo de ValidaÃ§Ã£o

### **Ablation Studies**

1. **Conv-Adapter:**
   - [ ] Î³ (reduction): 2, 4, 8, 16
   - [ ] Layers: layer4, layer3+4, all layers
   - [ ] Variant: conv_parallel vs residual_parallel

2. **Ensemble:**
   - [ ] Num models: 2, 3, 5
   - [ ] Voting: soft vs hard
   - [ ] Weights: fixed vs learnable

3. **HÃ­brido:**
   - [ ] Num adapters: 2, 3, 5
   - [ ] Adapter configs: diversidade vs uniformidade
   - [ ] Voting weights: inicializaÃ§Ã£o

### **Controles Experimentais**

- **Dataset:** Mesmo split (train/val) para TODAS soluÃ§Ãµes
- **Seed:** 42 (reprodutibilidade)
- **Hardware:** Mesma GPU (RTX 3090)
- **HiperparÃ¢metros base:** lr=1e-4, batch=128, epochs=100

### **MÃ©tricas de ComparaÃ§Ã£o**

âœ… **PrimÃ¡rias:**
- F1-score macro (stage-wise e pipeline)
- F1 per-class (especialmente classes raras)
- Confusion matrix

âœ… **SecundÃ¡rias:**
- Parameter efficiency (% trainable)
- Training time (epochs to convergence)
- Inference speed (samples/sec)
- GPU memory usage

---

## ğŸ“– DocumentaÃ§Ã£o Requerida

Para cada soluÃ§Ã£o, criar em `docs_v7/`:

1. **MotivaÃ§Ã£o** (problema especÃ­fico que resolve)
2. **Literatura** (5-10 papers citados)
3. **HipÃ³tese** (quantitativa, testÃ¡vel)
4. **Protocolo** (reprodutÃ­vel passo-a-passo)
5. **Arquitetura** (diagramas + equaÃ§Ãµes)
6. **Resultados** (tabelas + grÃ¡ficos)
7. **AnÃ¡lise** (por que funcionou/falhou?)
8. **LimitaÃ§Ãµes** (o que nÃ£o testamos?)
9. **ContribuiÃ§Ãµes** (inovaÃ§Ã£o acadÃªmica)
10. **ReferÃªncias** (bibliografia completa)

---

**Autor:** Chiaro Rosa  
**Data:** 14 de Outubro de 2025  
**VersÃ£o:** 7.0.0
